<!doctype html>
<!-- Conditional comment for mobile ie7 http://blogs.msdn.com/b/iemobile/ -->
<!-- Appcache Facts http://appcachefacts.info/ -->
<!--[if IEMobile 7 ]>    <html class="no-js iem7" manifest="default.appcache?v=1"> <![endif]-->
<!--[if (gt IEMobile 7)|!(IEMobile)]><!--> <html class="no-js" manifest="default.appcache?v=1"> <!--<![endif]-->

<head>
  <meta charset="utf-8">

  <title>QuakeFelt Mobile</title>
  <meta name="description" content="">
  <meta name="author" content="">
  
  <!-- Mobile viewport optimization http://goo.gl/b9SaQ -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- Home screen icon  Mathias Bynens http://goo.gl/6nVq0 -->
  <!-- For iPhone 4 with high-resolution Retina display: -->
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="img/h/apple-touch-icon.png">
  <!-- For first-generation iPad: -->
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="img/m/apple-touch-icon.png">
  <!-- For non-Retina iPhone, iPod Touch, and Android 2.1+ devices: -->
  <link rel="apple-touch-icon-precomposed" href="img/l/apple-touch-icon-precomposed.png">
  <!-- For nokia devices: -->
  <link rel="shortcut icon" href="img/l/apple-touch-icon.png">
  
  <!--iOS web app, deletable if not needed -->
  <!--<meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-startup-image" href="img/l/splash.png">-->
  
  <!-- Mobile IE allows us to activate ClearType technology for smoothing fonts for easy reading -->
  <meta http-equiv="cleartype" content="on">
	
	<!-- more tags for your 'head' to consider https://gist.github.com/849231 -->
  
  <!-- jQuery Mobile -->
  <link rel="stylesheet" href="http://code.jquery.com/mobile/1.0a4.1/jquery.mobile-1.0a4.1.min.css" />

  
  <!-- Main Stylesheet -->
  <link rel="stylesheet" href="css/style.css?v=1">
 
  <!-- All JavaScript at the bottom, except for Modernizr which enables HTML5 elements & feature detects -->
  <script src="js/libs/modernizr-custom.js"></script>
</head>

<body>

  <div data-role="page" data-theme="b" id="foo"> 
	<div  data-role="header">
		<h1>QuakeFelt</h1>
	</div> 
	<div data-role="content">
		<p>If you've experienced an earth quake recently please help us by filling out the form</p>
		<button data-icon="arrow-r" data-theme="a" data-role="button" data-transition="slide" id="getLocation">Start</button> 
	</div> 
   </div>
   
   <!-- Start of second page -->
   <div data-role="page" id="bar">

	<div data-role="header">
		<h1>QuakeFelt</h1>
	</div><!-- /header -->

	<div data-role="content">	
		
		
		<ul data-role="listview" id="recent-quakes">
			
		</ul>
	</div><!-- /content -->
   </div><!-- /page -->

  <!-- Grab Google CDN's jQuery, with a protocol relative URL; fall back to local if necessary -->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.js"></script>
  <script>window.jQuery || document.write("<script src='js/libs/jquery-1.5.1.min.js'>\x3C/script>")</script>
  
  <!-- JavaScript at the bottom for fast page loading -->
  <!-- You're shit is broken Keep getting errors
      <script src="js/script.js"></script>
	  -->
   <script>
   (function( win, doc ) {
	
		var location = doc.getElementById("getLocation"),
			body = doc.body,
			distanceThreshhold = 400;
		
		/* Geolocation */
		function getLocation() {
			
			// Data is loading
			$.mobile.pageLoading();
			
			if("geolocation" in navigator) {
				navigator.geolocation.getCurrentPosition(success, error); // Request live position
			} else {
				// Maybe do something if they don't have GPS. Fallback to postcode?
			}
			
			function success(pos) {
				var coords = pos.coords,
					lat = coords.latitude,
					lng = coords.longitude,
					list = $("#recent-quakes"),
					point, point2,
					point1 = new LatLon(lat, lng),
					noquake = true;

				
				// Build list of event sbased on RSS feed data, converted to JSON through YQL
				$.getJSON("http://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20rss%20where%20url%3D'http%3A%2F%2Fwww.ga.gov.au%2Fearthquakes%2Fall_recent.rss'&format=json&callback=?",function(data) {
				//$.getJSON("http://quakefelt.local/quakes.json",function(data) {
					// Clear list
					list.html("");
					
					$.each(data.query.results.item,function(index,key) {
						point = key.point.split(" ");
						point2 = new LatLon(point[0], point[1]);
						
						// Find any quakes within 400km of your location
						if(point1.distanceTo(point2) <= distanceThreshhold) {
							noquake = false;
							
							list.append(["<li><a href='form.html'>",
								"<h3>"+key.title+"</h3>",
								"<p>"+key.description+"</p>",
							"</a></li>"].join(''));
						}
					});
					
					if(noquake) {
						// No quakes within a 400km distance
						list.append(["<li>",
							"<h3>No quakes have been recorded in your area</h3>",
						"</li>"].join(''));
					}
					
					// Hide loader
					$.mobile.pageLoading(true);
					
					$.mobile.changePage("#bar", "slide");
				});
			}
			function error(err) {
				
			}
		}
		
		$(location).bind("click", getLocation);

	})( this, this.document );
   </script>
  
  <!-- jQuery Mobile -->
  <script src="js/libs/jquery.mobile-1.0a4.1.min.js"></script>
  
  <!-- Haversine forumla -->
  <script src="js/libs/latlon.js">/* Latitude/Longitude formulae */</script>

</body>
</html>
